# src/main/resources/application-prod.yml

spring:
  # --- 数据库连接 (PostgreSQL) ---
  datasource:
    driver-class-name: org.postgresql.Driver
    # host 改为 docker-compose 里的服务名 "postgres"
    url: jdbc:postgresql://postgres:5432/platform_db?currentSchema=public
    username: ${DB_USERNAME} # 读取环境变量
    password: ${DB_PASSWORD} # 读取环境变量

  # --- NoSQL & Cache ---
  data:
    mongodb:
      uri: mongodb://mongo:27017/rednote
      auto-index-creation: true
    redis:
      host: redis
      port: 6379
      database: 0
      password: ${REDIS_PASSWORD}

  # --- 邮件配置 (保持不变，读取环境变量) ---
  mail:
    host: ${MAIL_HOST}
    username: ${MAIL_USERNAME}
    password: ${MAIL_PASSWORD}
    default-encoding: UTF-8
    protocol: smtp
    properties:
      mail:
        smtp:
          auth: true
          starttls:
            enable: true
            required: true
          ssl:
            enable: true
          socketFactory:
            port: 465
            class: javax.net.ssl.SSLSocketFactory
    # --- Elasticsearch 配置 (新增) ---
  elasticsearch:
    # Docker 内部服务名:端口
    uris: http://afternoon-es:9200
    socket-timeout: 30s
    connection-timeout: 5s
    # 生产环境如果之后开启了 xpack，记得在这里配 username/password

# --- 阿里云 OSS ---
aliyun:
  oss:
    enable: true  # 设置为 false 启用本地 Mock 模式
    endpoint: ${ALIYUN_OSS_ENDPOINT:oss-cn-shenzhen.aliyuncs.com}
    access-key-id: ${ALIYUN_ACCESS_KEY_ID}
    access-key-secret: ${ALIYUN_ACCESS_KEY_SECRET}
    bucket-name: ${ALIYUN_BUCKET_NAME}
# --- 微信小程序 ---
wechat:
  appid: ${WECHAT_APPID}
  secret: ${WECHAT_SECRET}

# --- MyBatis Plus (生产环境优化) ---
mybatis-plus:
  mapper-locations: classpath:/mapper/*.xml
  type-aliases-package: com.szu.afternoon3.platform.entity
  configuration:
    # 生产环境显式覆盖
    log-impl: org.apache.ibatis.logging.nologging.NoLoggingImpl
    map-underscore-to-camel-case: true
  global-config:
    db-config:
      logic-delete-value: 1
      logic-not-delete-value: 0

logging:
  level:
    root: INFO # 全局默认是 INFO
    # 将 Listener 包单独设为 INFO (生产环境)
    com.szu.afternoon3.platform.listener: INFO

ai:
  deepseek:
    url: https://api.deepseek.com/chat/completions
    key: ${DEEPSEEK_API_KEY}
    model: deepseek-chat

  dashscope:
    api-key: ${QWENVL_API_KEY}
    model: qwen-vl-plus

  bot:
    user-id: ${CHATBOT_ID}
    user-nickname: ${CHATBOT_NICKNAME}